---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { t } from "../../i18n/i18n";
import { basePath } from "../../i18n/routes";
import type { Lang } from "../../data/site";
import { client, urlFor } from "../../lib/sanity";
import { SITE } from "../../data/site";

const { lang } = Astro.props as { lang: Lang };
const base = basePath(lang);

const featuredRaw = await client.fetch(`
  *[_type == "photo" && featured == true] | order(order asc, _createdAt desc)[0..5]{
    _id,
    title,
    alt,
    image
  }
`);

const FEATURED = (featuredRaw ?? [])
  .filter((p: any) => p?.image)
  .map((p: any) => ({
    src: urlFor(p.image).width(1400).auto("format").quality(80).url(),
    alt: p.alt || p.title || "Photo",
  }));
---

<BaseLayout lang={lang} title={t(lang, "nav.home")}>
  <section class="hero reveal">
    <h1 class="h1">{t(lang, "home.title")}</h1>
    <p class="p">{t(lang, "home.subtitle")}</p>
    <div class="hero-actions">
      <a class="btn" href={`${base}/gallery/`}>{t(lang, "home.cta")} →</a>
      <a class="btn btn-ghost" href={`${base}/contact/`}>{t(lang, "nav.contact")} →</a>
    </div>
  </section>

  <section class="grid2" style="margin-top: 18px;">
    <div class="card col7 pad reveal">
      <div class="home-card">
        <div class="home-cardhead">
          <div>
            <div class="kicker">{t(lang, "home.selectedWork.title")}</div>
            <h2 class="h2">{t(lang, "gallery.title")}</h2>
          </div>

          <a class="linkpill" href={`${base}/gallery/`}>
            {t(lang, "home.cta")} →
          </a>
        </div>

        {/* ✅ Platzhaltertext entfernt: kein home.selectedWork.body mehr */}
        {FEATURED.length > 0 ? (
          <div class="featured-grid">
            {FEATURED.map((p) => (
              <a href={`${base}/gallery/`} class="featured-link" aria-label="Open gallery">
                <figure class="featured-tile">
                  <img loading="lazy" src={p.src} alt={p.alt} />
                </figure>
              </a>
            ))}
          </div>
        ) : (
          <p class="p" style="margin-top: 10px;">
            {t(lang, "home.cta")}
          </p>
        )}
      </div>
    </div>

        <div class="card col5 pad reveal">
      <div class="home-card home-contact">
        <div class="home-cardhead">
          <div>
            <div class="kicker">{t(lang, "home.fastContact.title")}</div>
            <h2 class="h2">{t(lang, "contact.title")}</h2>
          </div>

          <a class="linkpill" href={`${base}/contact/`}>
            {t(lang, "nav.contact")} →
          </a>
        </div>

        <p class="p">{t(lang, "home.fastContact.body")}</p>

        <div class="contact-list">
          <a class="contact-item" href={`mailto:${SITE.email}`}>
            <span class="contact-icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M4 6.75C4 5.78 4.78 5 5.75 5h12.5C19.22 5 20 5.78 20 6.75v10.5c0 .97-.78 1.75-1.75 1.75H5.75C4.78 19 4 18.22 4 17.25V6.75Zm1.75-.25a.25.25 0 0 0-.25.25v.12l6.86 4.28a1.25 1.25 0 0 0 1.28 0L20.5 6.87v-.12a.25.25 0 0 0-.25-.25H5.75Zm14.75 2.1-6.05 3.78a2.75 2.75 0 0 1-2.9 0L5.5 8.6v8.65c0 .14.11.25.25.25h12.5c.14 0 .25-.11.25-.25V8.6Z"/>
              </svg>
            </span>
            <span class="contact-text">
              <span class="contact-label">Email</span>
              <span class="contact-value">{SITE.email}</span>
            </span>
          </a>

          {SITE.social.instagram && (
            <a class="contact-item" href={SITE.social.instagram} target="_blank" rel="noopener noreferrer">
              <span class="contact-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">
                  <path fill="currentColor" d="M7.75 2h8.5C19.44 2 22 4.56 22 7.75v8.5C22 19.44 19.44 22 16.25 22h-8.5C4.56 22 2 19.44 2 16.25v-8.5C2 4.56 4.56 2 7.75 2Zm0 1.5C5.4 3.5 3.5 5.4 3.5 7.75v8.5c0 2.35 1.9 4.25 4.25 4.25h8.5c2.35 0 4.25-1.9 4.25-4.25v-8.5c0-2.35-1.9-4.25-4.25-4.25h-8.5Zm4.25 4a4.75 4.75 0 1 1 0 9.5 4.75 4.75 0 0 1 0-9.5Zm0 1.5a3.25 3.25 0 1 0 0 6.5 3.25 3.25 0 0 0 0-6.5Zm4.9-.9a1.1 1.1 0 1 1 0 2.2 1.1 1.1 0 0 1 0-2.2Z"/>
                </svg>
              </span>
              <span class="contact-text">
                <span class="contact-label">Instagram</span>
                <span class="contact-value">@laiklife</span>
              </span>
            </a>
          )}
        </div>

        <div class="contact-cta">
          <a class="btn contact-btn" href={`${base}/contact/`}>
            {t(lang, "contact.send")} →
          </a>
        </div>
      </div>
    </div>
</BaseLayout>